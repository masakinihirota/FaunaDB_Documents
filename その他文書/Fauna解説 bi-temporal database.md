
用語
クロノン
最小時間単位

目次

第1章
Faunaとは？
第2章
FQLとは
第3章

SQLとFQLの違い
第4章
Temporal Databaseとは
第5章
BiTemporal Databaseとは
第6章
実例

第7章
時間
第8章
第9章
第10章




Fauna
Faunaとはデータベースの名前です。
MySQLとかPostgres、SQLiteみたいに、
たくさんあるデータベースの一つです。

Faunaで検索すると動物関連がたくさん出てきますので、
FaunaDBでよく検索されます。

英語でFaunaは
> 動物相（どうぶつそう、英:Fauna）
ある特定の地域と時間における動物を表す集合的な用語である。
これに対応する植物の集合の概念は植物相である。
さらに全生物を対象とする言葉に生物相がある。
ラテン語の仮名書きであるファウナの形でもよく使われる。
by wiki

Faunaではデータを操作する言語にSQLではなく、FQLを採用しています。

FQL
FQLとは、Faunaデータベース上のデータを操作をします。
リレーショナルデータベース上でSQLを使用するのと同じです。

SQLに相当するのがFQL言語。

ここでFauna最大の謎
なぜデータベースなのにSQLを使わないのか？
なぜデータベースなのにSQLを使わないのか？
なぜデータベースなのにSQLを使わないのか？
なぜデータベースなのにSQLを使わないのか？
なぜデータベースなのにSQLを使わないのか？

SQLは長年の実績があるし、ノウハウも積み重なっていて技術も枯れている
データベースを使うならSQL一択、他の選択肢はない。
と皆さん思っていると思います。

でも、なぜFQLという謎のデータベース操作言語をつかっているのでしょうか？

シンプルに言うと
SQLは日時を文字列と認識します
FQLでは日時を日時として認識します。

意味がわかりませんよね？

SQLで日時はよく使っているデータタイプだと、
データベースを触ったことがある人ならそう思うはずです。

でも本当にそうでしょうか？
SQLで日時を扱っているのでしょうか？

実を言うとSQLでは日時を扱っていません。
SQLでは数値と文字列の組み合わせたタイプの型という認識でしかありません。

SQLで日付を上書きしたら過去のデータは消えてしまい再現できません
プログラム等でサポートして別の場所に保存したりしなくてはなりません。

Faunaは従来のデータベースに時系列をシステムとして組み込んだ
次世代型のデータベースなのです。

時系列を組み込んだデータベースを
総じてTemporal Databaseといいます。

Temporalとは
現世の、世間的な、(空間に対して)時間的な、
一時の、(聖職者・教会に対して)聖職でない、
時を表わす、時制の、こめかみの、側頭の

temporal とは 意味・読み方・表現 | Weblio英和辞書
https://ejje.weblio.jp/content/temporal

感がいい人はもう分かったと思いますが、

Temporal Databaseはいくつか種類があって
Faunaはその数あるTemporal Databaseの種類の一つです。

Temporal Databaseとは
時間軸をデータベースの設計思想に組み込んだデータベースです。

時間を設計思想に組み込む？どういう言う意味でしょうか？

いままでのSQLでは日付は数値と文字列の組み合わせです。
SQL側は数値と文字列として認識していて
日付と認識していないのです。

SQLで日付の範囲などを命令しているのは単に数字を計算しているだけです。
研究者は考えました、
データベースに日付の概念をいれてみようと。
それでアレヤコレヤあって出来たのが
Temporal Databaseとなります。


なんとなく
Temporal Databaseとは何かと理解できたのではないでしょうか？
いままでSQLをデータ操作言語として扱ってきたデータベースから
さらに時間軸を組み込んだものを指します。

いままでのSQLでは表現できないことを扱えるようにしたのが
FQLということになります。
もちろんTemporal Databaseタイプは沢山研究されていて
Temporal Database専用の言語の標準はまだありません。
そのなかでFQLはFauna専用のデータ操作言語になります。

イメージ的には
1次元


Fauna は、BiTemporal データベースです。

BiTemporalとは？さっぱりわかりませんね。
というわけで調べてみました。

通常のリレーショナルデータベースは

SQLを使ってデータを操作します。
しかし

SQLではサポートされてない日付データを扱うために
FaunaではFQL言語を使います。

なぜ

SQLでは駄目なのですか？


SQLも日付に関する関数とかありますよね？

これは、当然の疑問です。

その理由を知る前にTemporalというデータベースを知る必要があります。
（BiTemporalではなくTemporalです。）

理解しやすくするために３次元で表現すると。
１次元、X軸だけで表現するのが

SQL
２次元、XY軸があるのがFauna、FQL言語
３次元、XYZ軸で表すタイプのデータベースもあります。

１次元だけで２二次元を表現するのは難しいので
FaunaはFQLというデータベース操作言語を開発して使用するわけです。

SQLが1次元のデータベースであるのに対して
Faunaは2次元のデータベースです。

１次元はデータは日付データを単なる文字列のデータとして扱います。

２次元は日付データをシステム内に組み込んでいます。

そして3次元のデータベースもあります。
Spatio-temporal Database
時空間データベース
時間や空間的な情報とを関連付けて表示されるデータ群を
より直接的により効率的に扱うためのデータベースです。

ここでTemporalの意味を調べてみると。
Temporal
現世の、世間的な、(空間に対して)時間的な、一時の、(聖職者・教会に対して)聖職でない、時を表わす、時制の、こめかみの、側頭の

というわけで
文字データに時間軸を絡めたデータベースを総じてTemporalデータベースと言います。

単純に時間軸を絡めただけですが、
そこは細かく研究されて
いくつかの種類のTemporalデータベースが開発されました。

FaunaのBiTemporalデータベースも
Temporalデータベースの1種というわけです。

今までは関数などを自作して日時を計算していましたが
システム内に組み込んで複雑な計算を任せてしまおうというのが
Temporalタイプのデータベースとなります。






リレーショナルデータベースとして使いたい場合は
GraphQLを使用すると入門しやすいでしょう。

時系列の概念を勉強すること無く使えます。
FQLなど無かったことにするのです。


tempral databaseの
標準化団体 は
ありません。

時間の解釈はそれぞれ複雑怪奇であり
当分標準化など望めそうにありません。

群雄割拠の時代です。

Faunaの特徴は
BiTempral databaseに加えて
サーバーレスデータベースだという特徴があります。

FQLは独自規格なのでSQLの知識はほとんど役に立ちません。






そのシステムの土台が違うものなので
SQLは使えないわけです。

オラクルとかは拡張機能でTemporal データベースのようなことも可能です。
でも拡張機能として扱うのと
設計思想として土台から組み込んであるのではまるで別物なのです。

旅館の増改築みたいな感じで複雑な構造になっていくのは目に見えています。
だからこそ1から設計を見直したTemporal Databaseに注目が集まっているわけです。

しかし通常のリレーショナルデータベースよりも
入門の壁が高く、
時間という概念を知っている必要があります。
時間という概念は思ったよりも複雑でデータベース熟練者でも
二の足を踏むことでしょう。

サッカー選手が野球選手に転向するようなものだからです。






SQLでも日時を取り扱えますが
SQL内のデータとしては単なる文字列です。

※最新のデータベースではオプションで時系列をサポートしているデータベースもあります。

時系列を扱うデータベースをTemporal Databaseと呼びます。

SQLは時系列と言う概念を想定していないので
人間側が配慮する必要があります。

時系列を想定したデータベースならば
時系列専用の命令があるわけです。

なのでFaunaはTemporal DatabaseだからSQLは使えないという意味がわかってもらえたと思います。

Temporal Databaseでもいろいろな種類があります。

時系列を研究すると時間という概念は
様々な種類のタイプが考えられます。
そこであるていど絞って
２つの概念を取り込んで作ったのが

BiTemporal Data Model
つまりBiTemporal Data Model
をもとに作ったのがFaunaとなるわけです。


BiTemporalとは
2つのTemporalという意味です。




Temporal Databaseとは

日時のデータをシステムとして理解して扱います。

エントリの時間依存ステータスを
サポートする特定の機能を備えたデータベースです。
一部のデータベースが現在のデータベースと見なされ、
使用時に有効と見なされる事実データのみをサポートする場合、
時制データベースは特定のエントリが正確である時間を確立できます。




言うなればFaunaは次世代型のデータベース
さらにサーバーレスでありインターネット時代の期待の星として現れたわけです。

しかしSQLの浸透度や枯れ具合から
Faunaに乗り越える人はごく少数です。

標準仕様がまだ決まっていないこと
未だ開発中であること
現実世界での使用例がまだ少ないことなどが理由のようです。
（ソースはありません、自分の直感です）






1,2,3次元とは

まずデータには2種類あると考えます。

valid time
transaction time
です。

valid timeは
ある要素が正しい場合にtrueとするパターン
データベース上にあるかどうかは関係がありません。

あなたが2000年4月1日に入社したなら
2000年4月1日以降はtrueと判定されます。

transaction timeは
データベース上にデータがある時間です。
2000年4月1日に入社して
2020年3月31日に退社したなら
transaction timeは
2000年4月1日～2020年3月31日です。

上記の2種類を組み合わせると
4つのパターンができあがります。

１	どちらも使用しない
Snapshot Model

２	valid timeだけ使う
Valid Time Data Model
Historical DB

３
transactional timeだけ使う
Transactional Data Model
Rollback DB

４
valid time と transactional timeの両方を使う
BiTemporal Data Model
Fauna DB

２－４の時刻を扱うデータベースを総じてTemporal databaseと呼びます。


Snapshot Model
このタイプは時刻情報を保持していません。
履歴の追跡は困難です。
追跡が不要なデータの場合はこのタイプのデータベースで十分です。
リレーショナルデータベース、

SQLで対応可能

Valid Time Data Model
このタイプは
リレーショナルデータベース、

SQLで対応可能

Transactional Data Model
このタイプは
リレーショナルデータベース、

SQLで対応可能

BiTemporal Data Model
このタイプは










----------------------------------------
----------------------------------------





●●●●●●●●●●●●●●●●●●●●●●●
●●●●●●●●●●●●●●●●●●●●●●●

PDF

現実世界のあらゆる現象において、
時間は重要な要素です。

時間的側面をモデル化

従来のデータベースは、
ある時点での企業の状態を表していました。
新しい情報が追加されると、
データベースの内容も変化していきますが、
この変化は状態の修正とみなされ、
古くなったデータはデータベースから削除されていきます。
データベースの現在の内容は、
企業のスナップショットと見なすことができます。


従来のデータベース管理システム（DBMS）
は日付を基本のデータタイプの値として解釈します。









●●●●●●●●●●●●●●●●●●●●●●●
●●●●●●●●●●●●●●●●●●●●●●●

参考
BiTemporal Data Modelに入門中
https://matsu-chara.hatenablog.com/entry/2017/04/01/110000



●●●●●●●●●●●●●●●●●●●●●●●
●●●●●●●●●●●●●●●●●●●●●●●

有効時間は、
事実が現実に真実であった時間に関係する。
ある事象の有効時間とは、
その事象が現実世界で発生した壁時計の時刻であり、
その事象がデータベースに記録されているかどうかとは無関係である。
ある事実が将来の特定の時間に真となることがわかっている場合、
有効時間は将来にもなり得る。

トランザクション時間は、
事実が保存データとしてデータベースに存在していた時間に関するものである。
あるイベントのトランザクション時間（間隔）は、
そのイベントに関する情報をデータベースに挿入したトランザクションと、
その情報をデータベースから削除したトランザクションを特定するものである。



この2つの次元は直交しています。

どちらもサポートしていないデータモデルはスナップショットと呼ばれ、

有効時間のみをサポートする日付モデルはヒストリカルと呼ばれ、

トランザクション時間のみをサポートするものはロールバックと呼ばれ、


有効時間とトランスアクション時間の
両方をサポートするものはビテンポラルと呼ばれます
（テンポラルは、何らかの時間サポートを意味する一般的な用語です）
。







●●●●●●●●●●●●●●●●●●●●●●●
●●●●●●●●●●●●●●●●●●●●●●●

決済システムの残高管理周りの DB 設計と戦略 - カンムテックブログ
https://tech.kanmu.co.jp/entry/2021/06/29/131649

Temporal Databaseを使えば－？



●●●●●●●●●●●●●●●●●●●●●●●
●●●●●●●●●●●●●●●●●●●●●●●





●●●●●●●●●●●●●●●●●●●●●●●
●●●●●●●●●●●●●●●●●●●●●●●





●●●●●●●●●●●●●●●●●●●●●●●
●●●●●●●●●●●●●●●●●●●●●●●





●●●●●●●●●●●●●●●●●●●●●●●
●●●●●●●●●●●●●●●●●●●●●●●





●●●●●●●●●●●●●●●●●●●●●●●
●●●●●●●●●●●●●●●●●●●●●●●





●●●●●●●●●●●●●●●●●●●●●●●
●●●●●●●●●●●●●●●●●●●●●●●





●●●●●●●●●●●●●●●●●●●●●●●
●●●●●●●●●●●●●●●●●●●●●●●





●●●●●●●●●●●●●●●●●●●●●●●
●●●●●●●●●●●●●●●●●●●●●●●





●●●●●●●●●●●●●●●●●●●●●●●
●●●●●●●●●●●●●●●●●●●●●●●





●●●●●●●●●●●●●●●●●●●●●●●
●●●●●●●●●●●●●●●●●●●●●●●





●●●●●●●●●●●●●●●●●●●●●●●
●●●●●●●●●●●●●●●●●●●●●●●





●●●●●●●●●●●●●●●●●●●●●●●
●●●●●●●●●●●●●●●●●●●●●●●





●●●●●●●●●●●●●●●●●●●●●●●
●●●●●●●●●●●●●●●●●●●●●●●





●●●●●●●●●●●●●●●●●●●●●●●
●●●●●●●●●●●●●●●●●●●●●●●





●●●●●●●●●●●●●●●●●●●●●●●
●●●●●●●●●●●●●●●●●●●●●●●





●●●●●●●●●●●●●●●●●●●●●●●
●●●●●●●●●●●●●●●●●●●●●●●





●●●●●●●●●●●●●●●●●●●●●●●
●●●●●●●●●●●●●●●●●●●●●●●





●●●●●●●●●●●●●●●●●●●●●●●
●●●●●●●●●●●●●●●●●●●●●●●





●●●●●●●●●●●●●●●●●●●●●●●
●●●●●●●●●●●●●●●●●●●●●●●





●●●●●●●●●●●●●●●●●●●●●●●
●●●●●●●●●●●●●●●●●●●●●●●





●●●●●●●●●●●●●●●●●●●●●●●
●●●●●●●●●●●●●●●●●●●●●●●





●●●●●●●●●●●●●●●●●●●●●●●
●●●●●●●●●●●●●●●●●●●●●●●





●●●●●●●●●●●●●●●●●●●●●●●
●●●●●●●●●●●●●●●●●●●●●●●





●●●●●●●●●●●●●●●●●●●●●●●
●●●●●●●●●●●●●●●●●●●●●●●





●●●●●●●●●●●●●●●●●●●●●●●
●●●●●●●●●●●●●●●●●●●●●●●












